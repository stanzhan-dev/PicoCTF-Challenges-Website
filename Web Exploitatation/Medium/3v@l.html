<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web Exploitation – Easy</title>
  <link rel="stylesheet" href="../css/writeup.css">

</head>

<body>
  <div class="writeup-layout">

    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <h2>Web Exploitation</h2>
      <h3><a href="../WebExDesc.html">Web Exploitation Overview</a>
</h3>
      <details closed>
  <summary>Easy Challenges</summary>
  <ul>
    <li><a href="../Easy/Crack_the_Gate_1.html">Crack the Gate 1</a></li>
    <li><a href="coming_soon.html">SSTI1</a></li>
    <li><a href="coming_soon.html">n0s4n1ty 1</a></li>
    <li><a href="../Easy/Cookie_Monster.html">Cookie Monster Secret Recipe</a></li>
    <li><a href="../Easy/Web_Decoder.html">WebDecode</a></li>
    <li><a href="../Easy/Unminify.html">Unminify</a></li>
    <li><a href="../Easy/introtoburpsuite.html">IntroToBurp</a></li>
    <li><a href="../Easy/Bookmarklet.html">Bookmarklet</a></li>
    <li><a href="../Easy/Local_Authority.html">Local Authority</a></li>
    <li><a href="../Easy/Inspect_HTML.html">Inspect HTML</a></li>
    <li><a href="../Easy/Includes.html">Includes</a></li>
    <li><a href="../Easy/Cookie.html">Cookies</a></li>
    <li><a href="../Easy/Scavenger_Hunt.html">Scavenger Hunt</a></li>
    <li><a href="../Easy/Get_aHead.html">GET aHEAD</a></li>
    <li><a href="../Easy/dont_use_client_side.html">dont-use-client-side</a></li>
    <li><a href="../Easy/logon.html">logon</a></li>
    <li><a href="../Easy/Insp3ct0r.html">Insp3ct0r</a></li>
    <li><a href="../Easy/where_are_the_robots.html">where are the robots</a></li>
  </ul>
</details>

    <details open>
  <summary>Medium Challenges</summary>
  <ul>
    <li><a href="Crack_the_Gate_2.html">Crack the Gate 2</a></li>
    <li><a href="">byp4ss3d</a></li>
    <li><a href="">Pachinko</a></li>
    <li><a href="">SSTI 2</a></li>
    <li><a href="3v@l.html">3v@l</a></li>
    <li><a href="coming_soon.html">WebSockFish</a></li>
    <li><a href="coming_soon.html">ApritiSesamo</a></li>
    <li><a href="">Trickster</a></li>
    <li><a href="No_SQL_Injection.html">No Sql Injection</a></li>
    <li><a href="">SOAP</a></li>
    <li><a href="More_SQLi.html">More SQLi</a></li>
    <li><a href="MatchTheRegex.html">MatchTheRegex</a></li>
    <li><a href="">Java Code Analysis!?!</a></li>
    <li><a href="">findme</a></li>
    <li><a href="">SQLiLite</a></li>
    <li><a href="">SQL Direct</a></li>
    <li><a href="Secrets.html">Secrets</a></li>
    <li><a href="">Search Source</a></li>
    <li><a href="Roboto_Sans.html">Roboto Sans</a></li>
    <li><a href="Power_Cookie.html">Power Cookie</a></li>
    <li><a href="Forbidden_Paths.html">Forbidden Paths</a></li>
    <li><a href="">JAuth</a></li>
    <li><a href="">caas</a></li>
    <li><a href="">login</a></li>
    <li><a href="SuperSerial.html">Super Serial</a></li>
    <li><a href="">Most Cookies</a></li>
    <li><a href="">Web Gauntlet 2</a></li>
    <li><a href="">Some Assembly Required 1</a></li>
    <li><a href="">Who are you?</a></li>
    <li><a href="">Some Assembly Required 2</a></li>
    <li><a href="">Web Gauntlet 3</a></li>
    <li><a href="">More Cookies</a></li>
    <li><a href="">It is my Birthday</a></li>
    <li><a href="">Startup Company</a></li>
    <li><a href="">Web Gauntlet</a></li>
    <li><a href="Irish-Name-Repo_1.html">Irish-Name-Repo 1</a></li>
    <li><a href="Irish-Name-Repo_2.html">Irish-Name-Repo 2</a></li>
    <li><a href="">Irish-Name-Repo 3</a></li>
    <li><a href="">Client-side-again</a></li>
    <li><a href="">picobrowser</a></li>
  </ul>
</details>

    <details closed>
  <summary>Hard Challenges</summary>
  <ul>
    <li><a href="">secure-email-service</a></li>
    <li><a href="">Pachinko Revisited</a></li>
    <li><a href="">elements</a></li>
    <li><a href="">msfroggenerator2</a></li>
    <li><a href="">cancri-sp</a></li>
    <li><a href="">noted</a></li>
    <li><a href="">Live Art</a></li>
    <li><a href="">notepad</a></li>
    <li><a href="">Bithug</a></li>
    <li><a href="">X marks the spot</a></li>
    <li><a href="">Some Assembly Required 3</a></li>
    <li><a href="">Some Assembly Required 4</a></li>
    <li><a href="">Java Script Kiddie</a></li>
    <li><a href="">Java Script Kiddie 2</a></li>
  </ul>
</details>

      <a class="back-home" href="../../index.html">← Back to Index</a>
    </aside>

    <!-- ===== CONTENT ===== -->
    <main class="content">
      <section id="challenge1">
        <h1>3v@l (Medium)</h1>
        <ul>
          <li>Challenge Link: https://play.picoctf.org/practice/challenge/484?category=1&difficulty=2&page=1</li>
          <li>Challenge Description: ABC Bank's website has a loan calculator to help its clients calculate the amount they pay if they take a loan from the bank. Unfortunately, they are using an eval function to calculate the loan. Bypassing this will give you Remote Code Execution (RCE). Can you exploit the bank's calculator and read the flag? Additional details will be available after launching your challenge instance.</li>
          <li>Hints:</li>
          <ol>
            <li>Bypass regex</li>
            <li>The flag file is /flag.txt</li>
            <li>You might need encoding or dynamic construction to bypass restrictions</li>
          </ol>
        </ul>
      </section>

      <section>
        <h1>Solution</h1>
        <p>If we look at the page source code, we can see that it's detecting certain keywords and using Regex.        </p>
        <pre>
    TODO
    ------------
    Secure python_flask eval execution by 
        1.blocking malcious keyword like os,eval,exec,bind,connect,python,socket,ls,cat,shell,bind
        2.Implementing regex: r'0x[0-9A-Fa-f]+|\\u[0-9A-Fa-f]{4}|%[0-9A-Fa-f]{2}|\.[A-Za-z0-9]{1,3}\b|[\\\/]|\.\.'
        </pre>
        <p>So if we try to read the flag.txt file, it wouldn't work since the regex detects the keyword .txt which is not allowed.</p>
        <pre>open('flag.txt').read()</pre>
        <p>If we analyze this using a regular expression tool, we know that this regex is a bunch of OR conditions stuck together.</p>
        <pre>| --&gt; OR</pre>
        <p>0x[0-9A-Fa-f]+ Detects hex numbers like:</p>
        <pre>
0x1
0xA
0xdeadBEEF
0x123abc

0x --&gt; literally the characters 0x

[0-9A-Fa-f] --&gt; any hex digit (0-9),(A-F),(a-f)

+ --&gt; one or more of the thing before it
        </pre>
        <p>\u[0-9A-Fa-f]{4} Detects unicode escape sequences like:</p>
        <pre>
\u0041   (A)
\u002e   (.)

So \\u matches the text \u

{4} means exactly 4 of the thing before it
\u0000 → \uFFFF
        </pre>
        <p>%[0-9A-Fa-f]{2} Detects URL-encoded bytes like:</p>
        <pre>
%2e   (.)
%2f   (/)
%41   (A)

% → literal percent sign
[0-9A-Fa-f]{2} → exactly two hex digits
        </pre>
        <p>.[A-Za-z0-9]{1,3}\b Detects short file extensions:</p>
        <pre>
.txt
.php
.js
.py
.exe

\. → literal dot

[A-Za-z0-9] → letter or number

{1,3} → 1 to 3 characters

\b → word boundary (end of word)
        </pre>
        <p>[\/] Detects either slash:</p>
        <pre>
/
\

[] → “any ONE of these”

\\ → backslash

\/ → forward slash
        </pre>
        <p>.. Detects:</p>
        <pre>
..

Classic directory traversal (../).
        </pre>
        <p>Quick summary:</p>
        <pre>
`	means `
+	means 1 or more
{n}	means exactly n
{n,m}	means between n and m
[] means any one character inside
\.	means the literal dot
\b	means the word boundary
        </pre>
        <p>But there are some ways we can bypass this, for example:</p>
        <pre>
Unicode characters (not escaped)
／   (Unicode slash)
．   (Unicode dot)

Long extensions
.filebackup
.php123

More than two dots
...
....

Mixed or double encoding
%252e   (decodes to %2e)

Whitespace tricks
. ./ 
.\n.
        </pre>
        <p>So as we mentioned earlier, this code does not work because / → blocked by [\/] and .txt → blocked by .[A-Za-z0-9]{1,3}</p>
        <pre>open('flag.txt').read()</pre>
        <p>However, if we try this:</p>
        <pre>open(chr(47)+'f'+'l'+'a'+'g'+'.'+'t'+'x'+'t').read()</pre>
        <p>This works because the regex checks your input before Python executes it.</p>
        <pre>
According the Ascii Table, chr(47) maps to /
Regex sees: chr(47)
Regex does not see: /

For 'f'+'l'+'a'+'g'+'.'+'t'+'x'+'t'
The regex rule: \.[A-Za-z0-9]{1,3}\b blocks .txt
Regex sees: 'f'+'l'+'a'+'g'+'.'+'t'+'x'+'t'
Regex does not see the output: flag.txt
        </pre>
        <p>Biggest takeaway is that Regex does not:</p>
        <ul>
          <li>Evaluate expression</li>
          <li>Execute functions</li>
          <li>Track string building</li>
          <li>Understand Python syntax</li>
          <li>Just matches text patterns</li>
        </ul>

        <img src="../Images/3v@l.jpg" alt="3v@l">
      </section>

      <section>
        <h1>Sources</h1>
        <ul>
          <li><a href="https://github.com/stanzhan-dev/PicoCTF-Challenges/blob/main/Web%20Exploitation/MatchTheRegex/MatchTheRegex.md">Similar CTF regarding Regex</a></li>
          <li><a href="https://regex101.com/">Regular Expressions 101</a></li>
          <li><a href="https://www.asciitable.com/">Ascii Table</a></li>
        </ul>
      </section>

    </main>
  </div>
</body>
</html>
